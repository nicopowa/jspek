/**
 * Nico Pr â€” https://nicopr.fr
 * JSPEK WORKER RELEASE v0.0.7
 * 15/12/2025 23:36:41
 */
(function(){const D={},E=({n:b,m:a,cos:g,sin:w},d,c)=>{for(var n=0;n<b;n++){var e=a[n];e>n&&([d[n],d[e]]=[d[e],d[n]],[c[n],c[e]]=[c[e],c[n]])}for(a=2;a<=b;a*=2){n=a/2;e=b/a;for(let k=0;k<b;k+=a)for(let v=0;v<n;v++){var h=v*e,f=g[h];const r=w[h];h=k+v;const l=h+n,m=d[l]*f-c[l]*r;f=d[l]*r+c[l]*f;d[l]=d[h]-m;c[l]=c[h]-f;d[h]+=m;c[h]+=f}}},G=new Uint32Array(256);
for(let b=0;b<256;b++){const a=b/255;G[b]=4278190080|(a<.6?.5*Math.sin(a/.6*Math.PI):a<.78?0:(a-.78)/.22)*255<<16|(a<.6?0:a<.91?Math.sin((a-.6)/.31*Math.PI/2):1)*255<<8|(a<.13?0:a<.73?Math.sin((a-.13)/.6*Math.PI/2):1)*255}const H={},I={};
self.onmessage=b=>{var a=b.data;if(a.type==="init")H[a.uid]={cvs:a.cvs,o:a.cvs.getContext("2d",{alpha:!1}),i:null,l:2048,g:null};else if(a.type==="destroy")delete H[a.uid],delete I[a.uid];else if(a.type==="audio"){if(b=H[a.uid]){b.i={chn:a.chn,spr:a.spr,j:a.chn.length};a=a.spr>88200?8192:a.spr>44100?4096:2048;b.l=a;b.g=new Float32Array(a);for(let e=0;e<a;e++)b.g[e]=.5*(1-Math.cos(2*Math.PI*e/a))}}else if(a.type==="render")I[a.uid]=a;else if(a.type==="export"&&(b=Object.values(H).map(e=>e.cvs),b.length)){var {width:g,
height:w}=b[0],d=Math.ceil(Math.sqrt(b.length));a=Math.ceil(b.length/d);var c=Math.min(1,4096/(d*g),4096/(a*w));a=new OffscreenCanvas(d*g*c,a*w*c);var n=a.getContext("2d",{alpha:!1});b.forEach((e,h)=>n.drawImage(e,h%d*g*c,(h/d|0)*w*c,g*c,w*c));a.convertToBlob().then(e=>e.arrayBuffer()).then(e=>postMessage({type:"export",data:e},[e]))}};const L=()=>{for(const b in I)K(b,I[b]),delete I[b];requestAnimationFrame(L)};L();
const K=(b,{lay:a,zoom:g,pan:w,dpr:d,dat:c,drg:n,log:e})=>{var h=H[b];if(h&&a.w&&a.h){b=h.o;var f=h.i,k=h.l;h=h.g;var v=a.x,r=a.y,l=a.w,m=a.h,z=a.fh;b.canvas.width=a.fw;b.canvas.height=z;M(b,a,d,c,f,g,w,e);if(f){a=f.j;d=f.chn;var u=f.spr;if(D[k])f=D[k];else{f=new Uint32Array(k);c=new Float32Array(k/2);z=new Float32Array(k/2);var y=-2*Math.PI/k;for(let F=1,J=k>>1;F<k;F<<=1,J>>=1)for(var p=0;p<F;p++)f[p+F]=f[p]+J;for(p=0;p<k/2;p++)c[p]=Math.cos(y*p),z[p]=Math.sin(y*p);f=D[k]={n:k,m:f,cos:c,sin:z}}c=
k>>1;n=n?4:1;g=Math.max(1,(Math.floor((w+1/g)*a)-Math.floor(w*a))/l|0);z=20*Math.log10(1/k);y=new Float32Array(k);p=new Float32Array(k);var A=new ImageData(l,m),B=new Uint32Array(A.data.buffer),C=new Float32Array(m*2);if(e){e=Math.log(Math.min(u/2,2E4)/20);u=k/u;for(var q=0;q<m;q++)C[q*2]=Math.max(0,20*Math.exp((m-q-1)/m*e)*u),C[q*2+1]=Math.min(c-1,20*Math.exp((m-q)/m*e)*u)}else for(e=c/m,u=0;u<m;u++)C[u*2]=(m-u-1)*e,C[u*2+1]=(m-u)*e;for(e=0;e<l;e+=n){q=Math.floor(w*a)+Math.round((e+(n-1)/2)*g)-c;
u=0;for(var t=0;t<k;t++){var x=q+t>=0&&q+t<a?d[q+t]:0;y[t]=x;u+=x}u/=k;for(q=0;q<k;q++)y[q]=(y[q]-u)*h[q],p[q]=0;E(f,y,p);for(u=0;u<m;u++){x=C[u*2];t=C[u*2+1];q=0;if(t-x<1)q=(x+t)*.5,t=Math.floor(q),x=t>=0&&t<c?y[t]**2+p[t]**2:0,q=x+(q-t)*((t+1>=0&&t+1<c?y[t+1]**2+p[t+1]**2:0)-x);else for(x=Math.floor(x),t=Math.ceil(t),x=Math.max(0,x);x<Math.min(c,t);x++)q=Math.max(q,y[x]**2+p[x]**2);q=G[Math.max(0,Math.min(255,(10*Math.log10(q+1E-20)+z- -120)/120*255|0))];for(t=e;t<Math.min(l,e+n);t++)B[u*l+t]=q}}b.putImageData(A,
v,r)}}},M=(b,{x:a,y:g,w,h:d,fw:c,fh:n},e,h,f,k,v,r)=>{const l=4*e,m=Math.max(8,Math.min(12,Math.min(w,d)/25))*e;b.fillStyle="#000";b.fillRect(0,0,c,n);b.fillStyle="#757575";b.strokeStyle="#757575";b.strokeRect(0,0,c,n);b.fillStyle="#939393";b.font=`${m*1.2}px system-ui`;b.textAlign="left";b.textBaseline="middle";n=h.nnm;if(b.measureText(n).width>c-a*2){for(;n.length>0&&b.measureText(n+"\u2026").width>c-a*2;)n=n.slice(0,-1);n+="\u2026"}b.fillText(n,a,g/3);b.fillStyle="#646464";b.font=`${m*.9}px system-ui`;
b.fillText(h.inf,a,g*3/4);if(f){c=f.spr;f=f.j;var z=c/2;b.fillStyle="#434343";b.textAlign="right";b.font=`${m*.8}px system-ui`;var u=(p,A)=>{A>g+m&&A<g+d-m&&(b.fillText(p,a-l-4,A),b.fillRect(a-l,A,l,1))};if(r){const p=Math.min(z,2E4),A=Math.log(p/20);[20,50,100,200,500,1E3,2E3,5E3,1E4,2E4].forEach(B=>{B<=p&&u(B>=1E3?B/1E3+"k":B,g+d-Math.log(B/20)/A*d)});d>m*4&&(b.fillText(Math.round(p/1E3)+"k",a-l-4,g),b.fillRect(a-l,g-1,l,1),b.fillText("20",a-l-4,g+d),b.fillRect(a-l,g+d,l,1));g>m*1.5&&b.fillText("Hz",
a-l-5,g-m)}else{r=[1E3,2E3,5E3,1E4,2E4,5E4];r=r.find(p=>z/p<=Math.max(2,d/(m*2.5)))||r[r.length-1];for(h=0;h<=z;h+=r)u(Math.round(h/1E3),g+d-h/z*d);d>m*4&&(b.fillText(Math.round(z/1E3),a-l-4,g),b.fillRect(a-l,g-1,l,1),b.fillText("0",a-l-4,g+d),b.fillRect(a-l,g+d,l,1));g>m*1.5&&b.fillText("kHz",a-l,g-m)}b.fillStyle="#646464";b.textAlign="center";b.textBaseline="top";r=f/c;var y=r/k;k=v*r;v=[1,2,5,10,30,60,120,300,600,1800];v=v.find(p=>y/p<=Math.max(2,w/(m*4)))||v[v.length-1];for(r=Math.ceil(k/v)*v;r<=
k+y;r+=v)f=a+(r-k)/y*w,f>=a&&f<=a+w&&(c=r/60|0,h=r%60|0,b.fillText(c>0?`${c}:${h.toString().padStart(2,"0")}`:`${h}s`,f,g+d+l+4),b.fillRect(f-1,g+d,1,l));b.fillStyle="#434343";k=a+w+3*e;v=Math.floor(6*e);r=new Uint32Array(b.createImageData(v,d+1).data.buffer);for(f=0;f<=d;f++)for(c=G[(1-f/d)*255|0],h=0;h<v;h++)r[f*v+h]=c;b.putImageData(new ImageData(new Uint8ClampedArray(r.buffer),v,d+1),k,g-1);g>m*1.5&&(b.textAlign="left",b.textBaseline="middle",b.fillText("dB",k+v+12,g-m));r=[10,20,30,40,60].find(p=>
120/p<=Math.max(2,d/(m*2)))||60;for(f=-120;f<=0;f+=r)c=g+d-(f- -120)/120*(d+1),b.fillText(f,k+v+6,c),b.fillRect(k-3*e,c,6,1);b.strokeRect(a,g,w,d)}};}).call(this);
