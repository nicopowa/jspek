/**
 * Nico Pr â€” https://nicopr.fr
 * JSPEK PACKAGE RELEASE v0.0.9
 * 15/12/2025 23:36:34
 */
(function(){let k=null,n=0;const p=(a,b={},c)=>k.postMessage({type:a,...b},[...(c?[c]:[])]);
var q=a=>({j:"FLAC",spr:a.getUint8(18)<<12|a.getUint8(19)<<4|a.getUint8(20)>>4,chn:(a.getUint8(20)>>1&7)+1,l:((a.getUint8(20)&1)<<4|a.getUint8(21)>>4)+1}),t=a=>{let b=12,c={j:"WAV",A:!0};for(;b<a.byteLength-8;){var d=a.getUint32(b);const e=a.getUint32(b+4,!0);if(d===1718449184){d=a.getUint16(b+8,!0);c.j=d===3?"WAV (Float)":"WAV (PCM)";c.chn=a.getUint16(b+10,!0);c.spr=a.getUint32(b+12,!0);c.l=a.getUint16(b+22,!0);break}b+=8+e}return c},u=a=>{let b=12,c={j:"AIFF",A:!0};for(;b<a.byteLength-8;){var d=
a.getUint32(b);const e=a.getUint32(b+4);if(d===1129270605){c.chn=a.getInt16(b+8);c.l=a.getInt16(b+14);d=a.getUint16(b+16)&32767;a=a.getUint32(b+18);d>0&&(c.spr=a*Math.pow(2,d-16383-31));break}b+=8+(e+1&-2)}return c},v=a=>{let b=0;a.getUint32(0)>>>8===4801587&&(b=10+(a.getUint8(6)<<21|a.getUint8(7)<<14|a.getUint8(8)<<7|a.getUint8(9)));return b<a.byteLength-4&&(a=a.getUint32(b),(a>>>21&2047)===2047)?{j:"MP3",spr:{3:[44100,48E3,32E3],2:[22050,24E3,16E3],0:[11025,12E3,8E3]}[a>>>19&3]?.[a>>>10&3]||44100}:
{j:"MP3"}},w=a=>{const b=27+a.getUint8(26),c=a.getUint32(b+1);return a.getUint8(b)===1&&c===1987015266?{j:"Vorbis",chn:a.getUint8(b+11),spr:a.getUint32(b+12,!0)}:a.getUint32(b)===1332770163?{j:"Opus",chn:a.getUint8(b+9),spr:a.getUint32(b+12,!0)}:{j:"OGG"}},x=a=>{let b={j:"AAC",A:!1};const c=(e,h,g)=>{for(;e<h-8;){const m=a.getUint32(e);if(m<8||e+m>h)break;var f=a;var l=e+4;f=String.fromCharCode(f.getUint8(l),f.getUint8(l+1),f.getUint8(l+2),f.getUint8(l+3));if(g(f,e,m))return!0;e+=m}},d=(e,h)=>{c(e,
h,(g,f,l)=>{if("moov trak mdia minf stbl stsd".split(" ").includes(g))return d(f+(g==="stsd"?16:8),f+l);if(g==="alac")return b.j="ALAC",b.A=!0,b.chn=a.getUint16(f+24),b.l=a.getUint16(f+26),b.spr=a.getUint32(f+32)>>>16,g=a.getUint16(f+16)===1?52:36,c(f+g,f+l,(m,r)=>{if(m==="alac")return b.l=a.getUint8(r+17),b.chn=a.getUint8(r+21),b.spr=a.getUint32(r+32),!0}),!0;if(g==="mp4a")return b.chn=a.getUint16(f+24),b.spr=a.getUint32(f+32)>>>16,!0})};d(0,a.byteLength);return b},y=()=>({j:"APE"});
function z(a){const b=c=>{a.drg&&(a.drg=!1,a.cvs.releasePointerCapture(c.pointerId),A(a),a.o.pan(a,!1))};a.cvs.onpointerdown=c=>{if(a.v&&a.zoom!==1){a.drg=!0;a.i=!1;a.cvs.setPointerCapture(c.pointerId);var d=a.cvs.getBoundingClientRect();a.u=a.pan+((c.clientX-d.left)*a.dpr-a.lay.x)/a.lay.w*(1/a.zoom)}};a.cvs.onpointermove=c=>{if(a.drg){a.i=!0;var d=a.cvs.getBoundingClientRect(),e=1/a.zoom;a.pan=Math.max(0,Math.min(1-e,a.u-((c.clientX-d.left)*a.dpr-a.lay.x)/a.lay.w*e));A(a,!0);a.o.pan(a,!0)}};a.cvs.onpointerup=
b;a.cvs.onpointercancel=b}function A(a,b=!1){a.g||(a.g=requestAnimationFrame(()=>{p("render",{uid:a.uid,lay:a.lay,zoom:a.zoom,pan:a.pan,dpr:a.dpr,dat:a.dat,drg:b,log:a.o.low});a.g=null}))}function B(a){a.g&&cancelAnimationFrame(a.g);p("destroy",{uid:a.uid});a.m.remove()}
function C(a,b){const c=new DataView(b),d={spr:44100,chn:2,l:0,A:!1,j:"?"};if(b.byteLength<12)return d;b=a.name.slice(a.name.lastIndexOf(".")+1);let e=a.type||b||"";try{a={wav:t,aiff:u,flac:q,ogg:w,mp4:x,m4a:x,aac:x,adts:x,mp3:v,mpeg:v,ape:y};const h=Object.keys(a).find(g=>e.includes(g));h&&Object.assign(d,a[h](c))}catch(h){console.error("meta fail",h)}return d}function D(a){return[Math.floor(a/60),Math.floor(a%60)].map(b=>(b+"").padStart(2,"0")).join(":")}
function E(a,b){if(a.v&&(b=Math.max(1,Math.min(64,a.zoom*b)),b!==a.zoom)){var c=a.pan+1/a.zoom/2;a.zoom=b;a.pan=Math.max(0,Math.min(1-1/b,c-1/b/2));A(a)}}
class F{constructor(a,b){this.o=b;this.uid=++n;this.dpr=window.devicePixelRatio||1;this.v=!1;this.dat={nnm:a.name,inf:"Loading"};this.lay={x:0,y:0,w:0,h:0,fw:0,fh:0};this.zoom=1;this.u=this.pan=0;this.i=this.drg=!1;this.g=null;this.m=document.createElement("div");this.m.className="spek";this.cvs=document.createElement("canvas");this.m.append(this.cvs);b.B.append(this.m);b=this.cvs.transferControlToOffscreen();p("init",{uid:this.uid,cvs:b},b);z(this);this.load(a)}layout(){const a=this.dpr,b=Math.floor(this.m.clientWidth*
a),c=Math.floor(this.m.clientHeight*a);this.lay={x:Math.floor(24*a),y:Math.floor(36*a),w:Math.floor(b-56*a),h:Math.floor(c-54*a),fw:b,fh:c};A(this)}async load(a){try{const b=await a.arrayBuffer(),c=C(a,b),d=a.size/1048576;let e;try{e=await (new OfflineAudioContext(1,1,c.spr)).decodeAudioData(b)}catch(f){throw Error(`${c.j} unsupported`);}this.v=!0;let h=c.A&&c.l&&c.spr?Math.round(c.spr*c.chn*c.l/1E3):Math.round(a.size*8/e.duration/1E3);this.dat.inf=`${c.j} ${Math.round(e.sampleRate/1E3)}kHz${c.l?
" "+c.l+"bit":""} ${e.numberOfChannels}ch ${D(e.duration)} ${h}kbps ${d>=1?d.toFixed(2)+"MB":(a.size/1024).toFixed(1)+"KB"}`;const g=e.getChannelData(0);p("audio",{uid:this.uid,chn:g,spr:e.sampleRate},g.buffer)}catch(b){this.dat.inf="Error: "+b.message}A(this)}}
function G(a,b=!1){var c=a.i.size;if(c){var d=Math.ceil(Math.sqrt(c));c=Math.ceil(c/d);a.B.style.gridTemplateColumns=`repeat(${d}, 1fr)`;a.B.style.gridTemplateRows=`repeat(${c}, 1fr)`;b===!0||d!==a.C||c!==a.D?a.i.forEach(e=>e.layout()):b&&b.layout();a.C=d;a.D=c}}function H(a){a.low=!a.low;document.querySelector("#low").classList.toggle("actv",a.low);a.i.forEach(b=>A(b))}function I(a){a.i.forEach(b=>{b.v&&J(a,b)})}
function K(a,b){b.m.classList.remove("fcs");a.g.delete(b);a.g.size||a.G.classList.add("nope")}function J(a,b){a.g.size||a.G.classList.remove("nope");a.g.add(b);b.m.classList.add("fcs")}function L(a){a.i.forEach(b=>K(a,b))}
class M{constructor(){this.i=new Set;this.B=document.querySelector("#wrp");this.G=document.querySelector("#tools");this.u=document.querySelector("#files");this.g=new Set;this.F=null;this.low=this.o=!1;this.D=this.C=0;k=new Worker("js/jspek.worker.release.min.js");k.onmessage=a=>{if(a.data.type==="export"){a=URL.createObjectURL(new Blob([a.data.data],{type:"image/png"}));const b=document.createElement("a");b.download=`jspek_${Date.now()}.png`;b.href=a;b.click();URL.revokeObjectURL(a)}};this.u.onchange=
()=>this.add(this.u.files);document.body.ondragover=a=>a.preventDefault();document.body.ondrop=a=>{a.preventDefault();this.add(a.dataTransfer.files)};window.onresize=()=>{clearTimeout(this.F);this.F=setTimeout(()=>G(this,!0),123)};Object.entries({browse:()=>this.u.click(),"export":()=>p("export"),clear:()=>{this.i.forEach(a=>B(a));this.i.clear()},select:()=>{this.g.size>this.i.size/2?L(this):I(this)},sync:()=>{this.o=!this.o;document.querySelector("#sync").classList.toggle("actv",this.o)},low:()=>
H(this),zoomin:()=>this.g.forEach(a=>E(a,2)),zoomout:()=>this.g.forEach(a=>E(a,.5)),reset:()=>this.g.forEach(a=>{a.v&&(a.zoom=1,a.pan=0,A(a))}),remove:()=>this.g.forEach(a=>{this.g.delete(a);B(a);this.i.delete(a);G(this);this.i.size===1&&I(this)})}).forEach(([a,b])=>document.querySelector("#"+a).onclick=b)}add(a){[...a].forEach(b=>{const c=new F(b,this);this.i.add(c);c.m.onclick=()=>{c.i?c.i=!1:this.g.has(c)?K(this,c):J(this,c)}});G(this,!0);this.i.size===1&&I(this)}pan(a,b){this.o&&this.g.forEach(c=>
{c.uid!==a.uid&&(c.pan=a.pan,A(c,b))})}}window.onload=()=>new M;}).call(this);
